name: æ¨é€æ–‡ä»¶åˆ°vercelåˆ†æ”¯

on:
  workflow_dispatch:
  push:
    branches: [ main ]  # ç›‘å¬çš„æºåˆ†æ”¯

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write   # å¿…é¡»çš„å†™å…¥æƒé™

    steps:
      - name: 1. æ£€å‡ºæºç  ğŸ›ï¸
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # è·å–å®Œæ•´å†å²

      - name: 2. é…ç½® Git èº«ä»½ âš™ï¸
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

      - name: 3. å¼ºåˆ¶æ¨é€æ‰€æœ‰æ–‡ä»¶ ğŸš€
        run: |
          # åˆ‡æ¢åˆ°æ–°åˆ†æ”¯ï¼ˆè‡ªåŠ¨å¤„ç†åˆ†æ”¯å­˜åœ¨ä¸å¦ï¼‰
          git checkout --orphan vercel-temp
          git rm -rf --quiet .  # æ¸…ç†æ—§æ–‡ä»¶
          
          # æ·»åŠ æ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬éšè—æ–‡ä»¶ï¼‰
          cp -r ../$(basename $GITHUB_REPOSITORY)/. .
          git add -A
          
          # æäº¤å¹¶å¼ºåˆ¶æ¨é€
          git commit -m "Full push: ${{ github.sha }}"
          git branch -M vercel  # é‡å‘½åä¸ºç›®æ ‡åˆ†æ”¯
          git push origin vercel --force
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
