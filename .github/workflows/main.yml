name: Push All to Vercel Branch

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: 1. 检出源码 🛎️
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: 2. 配置 Git 身份 ⚙️
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

      - name: 3. 强制推送所有文件到 Vercel 分支 🚀
        run: |
          # 切换到新分支（保留现有文件）
          git checkout --orphan vercel
          git add -A
          git commit -m "Full push: ${{ github.sha }}"
          git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}
          git push origin vercel --force
